{"version":3,"sources":["../../../../lib/auth/current-user.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\nimport { cookies } from \"next/headers\";\n\nexport type DevUserRole = 'client' | 'admin' | 'agent' | 'client_fresh';\n\nexport const DEV_USERS: Record<DevUserRole, { id: string; email: string; role: DevUserRole }> = {\n    client: {\n        id: '00000000-0000-0000-0000-000000000001',\n        email: 'dev_applicant@example.com',\n        role: 'client'\n    },\n    admin: {\n        id: '00000000-0000-0000-0000-000000000002',\n        email: 'dev_admin@example.com',\n        role: 'admin'\n    },\n    agent: {\n        id: '00000000-0000-0000-0000-000000000003',\n        email: 'dev_agent@example.com',\n        role: 'agent'\n    },\n    client_fresh: {\n        id: '00000000-0000-0000-0000-000000000004',\n        email: 'dev_fresh@example.com',\n        role: 'client_fresh'\n    }\n};\n\nexport async function getCurrentUser() {\n    const cookieStore = await cookies();\n    const isDev = process.env.NEXT_PUBLIC_DEV_MODE === 'true';\n\n    // 1. Dev Mode Bypass\n    if (isDev) {\n        const devUserRole = cookieStore.get('x-dev-user')?.value as DevUserRole | undefined;\n        if (devUserRole && DEV_USERS[devUserRole]) {\n            const devUser = DEV_USERS[devUserRole];\n            // Return structure matching supabase.auth.getUser()\n            return {\n                data: {\n                    user: {\n                        id: devUser.id,\n                        email: devUser.email,\n                        role: 'authenticated', // Supabase Auth role\n                        aud: 'authenticated',\n                        app_metadata: { provider: 'email' },\n                        user_metadata: { name: `Dev ${devUserRole.charAt(0).toUpperCase() + devUserRole.slice(1)}` },\n                        created_at: new Date().toISOString(),\n                    }\n                },\n                error: null\n            };\n        }\n    }\n\n    // 2. Real Supabase Auth\n    const supabase = createServerClient(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n        {\n            cookies: {\n                get(name: string) {\n                    return cookieStore.get(name)?.value;\n                },\n                set(name: string, value: string, options: any) {\n                    try {\n                        cookieStore.set({ name, value, ...options });\n                    } catch (error) {\n                        // The `set` method was called from a Server Component.\n                        // This can be ignored if you have middleware refreshing\n                        // user sessions.\n                    }\n                },\n                remove(name: string, options: any) {\n                    try {\n                        cookieStore.set({ name, value: '', ...options });\n                    } catch (error) {\n                        // The `delete` method was called from a Server Component.\n                        // This can be ignored if you have middleware refreshing\n                        // user sessions.\n                    }\n                },\n            },\n        }\n    );\n\n    return await supabase.auth.getUser();\n}\n"],"names":[],"mappings":"uCAAA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,MAIO,IAAM,EAAmF,CAC5F,OAAQ,CACJ,GAAI,uCACJ,MAAO,4BACP,KAAM,QACV,EACA,MAAO,CACH,GAAI,uCACJ,MAAO,wBACP,KAAM,OACV,EACA,MAAO,CACH,GAAI,uCACJ,MAAO,wBACP,KAAM,OACV,EACA,aAAc,CACV,GAAI,uCACJ,MAAO,wBACP,KAAM,cACV,CACJ,EAEO,eAAe,IAClB,IAAM,EAAc,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,GAItB,EACP,IAAM,EAAc,EAAY,GAAG,CAAC,eAAe,MACnD,GAAI,GAAe,CAAS,CAAC,EAAY,CAAE,CACvC,IAAM,EAAU,CAAS,CAAC,EAAY,CAEtC,MAAO,CACH,KAAM,CACF,KAAM,CACF,GAAI,EAAQ,EAAE,CACd,MAAO,EAAQ,KAAK,CACpB,KAAM,gBACN,IAAK,gBACL,aAAc,CAAE,SAAU,OAAQ,EAClC,cAAe,CAAE,KAAM,CAAC,IAAI,EAAE,EAAY,MAAM,CAAC,GAAG,WAAW,GAAK,EAAY,KAAK,CAAC,GAAA,CAAI,AAAC,EAC3F,WAAY,IAAI,OAAO,WAAW,EACtC,CACJ,EACA,MAAO,IACX,CACJ,CACJ,CAGA,IAAM,EAAW,CAAA,EAAA,EAAA,kBAAA,AAAkB,EAAA,2CAAA,mNAG/B,CACI,QAAS,KACL,AAAI,GACO,CADK,CACO,GAAG,CAAC,IAAO,MAElC,IAAI,CAAY,CAAE,CAAa,CAAE,CAAY,EACzC,GAAI,CACA,EAAY,GAAG,CAAC,MAAE,QAAM,EAAO,GAAG,CAAO,AAAC,EAC9C,CAAE,MAAO,EAAO,CAIhB,CACJ,EACA,OAAO,CAAY,CAAE,CAAY,EAC7B,GAAI,CACA,EAAY,GAAG,CAAC,MAAE,EAAM,MAAO,GAAI,GAAG,CAAO,AAAC,EAClD,CAAE,MAAO,EAAO,CAIhB,CACJ,CACJ,CACJ,GAGJ,OAAO,MAAM,EAAS,IAAI,CAAC,OAAO,EACtC"}